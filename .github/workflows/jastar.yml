- name: Fetch JioTV playlist and update jstar.m3u (preserve headers + append token)
        run: |
          set -e

          HEADER_FILE=header.m3u
          BODY_FILE=body.m3u
          TEMP_FILE=temp.m3u

          cat > "$HEADER_FILE" <<'EOF'
#EXTM3U x-tvg-url="https://raw.githubusercontent.com/undertaker321/epg/refs/heads/main/jio.xml.gz"
#Generated on $(date +%s)
EOF

          curl -s \
            -H "User-Agent: Dalvik/2.1.0 (Linux; Android 9)" \
            -H "Accept-Encoding: gzip" \
            --compressed \
            -o "$TEMP_FILE" \
            "https://livetv-cb7.pages.dev/hotstar"

          # Remove old header
          grep -vE '^#EXTM3U|^#Generated on' "$TEMP_FILE" > "$BODY_FILE"

          # âœ¨ Extract token from #EXTHTTP and append to stream URLs
          awk '
          /#EXTHTTP:/ {
            match($0, /__hdnea__=[^"}]+/, token);
            currentToken = token[0];
            print;
            next
          }
          /^https?:\/\/.*index\.(mpd|m3u8)/ {
            if (currentToken != "")
              print $0 "?" currentToken "&xxx=||cookie=" currentToken;
            else
              print;
            next
          }
          { print }
          ' "$BODY_FILE" > playlist.m3u

          # Combine header + body
          cat "$HEADER_FILE" playlist.m3u > jstar.m3u

          rm -f "$HEADER_FILE" "$BODY_FILE" "$TEMP_FILE" playlist.m3u
