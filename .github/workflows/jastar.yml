- name: Fetch JioTV playlist and update jstar.m3u (preserve headers)
  run: |
    set -e

    HEADER_FILE=header.m3u
    BODY_FILE=body.m3u
    TEMP_FILE=temp.m3u

    # 1️⃣ Define fixed header (never changes)
    cat > "$HEADER_FILE" <<'EOF'
#EXTM3U x-tvg-url="https://raw.githubusercontent.com/undertaker321/epg/refs/heads/main/epg.xml.gz"
#Generated on 1766625114
EOF

    # 2️⃣ Fetch remote playlist
    curl -s -H "User-Agent: Dalvik/2.1.0 (Linux; U; Android 9; Pixel 4 Build/PQ3A.190801.002)" \
         -H "Accept-Encoding: gzip" \
         -H "Connection: Keep-Alive" \
         --compressed \
         -o "$TEMP_FILE" \
         "https://livetv-cb7.pages.dev/hotstar"

    # 3️⃣ Remove any EXT M3U headers & Generated lines from fetched file
    grep -vE '^#EXTM3U|^#Generated on' "$TEMP_FILE" > "$BODY_FILE"

    # 4️⃣ Combine header + updated body
    cat "$HEADER_FILE" "$BODY_FILE" > jstar.m3u

    # 5️⃣ Cleanup
    rm -f "$HEADER_FILE" "$BODY_FILE" "$TEMP_FILE"
