name: Update Jio (__hdnea__) playlist as jstar.m3u

on:
  schedule:
    - cron: '0 */11 * * *'
  workflow_dispatch:

jobs:
  update-jstar-playlist:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Fetch JioTV playlist
      run: |
        curl -s -L -o playlist.m3u "https://m3u-fetcher.vercel.app/hotstar.m3u"

    - name: Format playlist to jstar format
      run: |
        awk '
        BEGIN { 
            print "[\n"; 
            first=1; 
        }
        /^#EXTINF/ {
            # Extract values using regex matching
            match($0, /group-title="([^"]*)"/, group);
            match($0, /tvg-logo="([^"]*)"/, logo);
            
            # Extract the channel name that comes after the comma
            sub(/.*,/, "");
            name = $0;
            
            # Get the next line which contains the URL
            getline;
            
            # Split the line by "|" and take the first part as the URL
            split($0, url_parts, "|");
            url = url_parts[1];
            
            # Print the formatted entry
            if (!first) {
                print ",\n";
            }
            first=0;
            
            printf "  {\n";
            printf "    name: \"%s\",\n", name;
            printf "    logo: \"%s\",\n", logo[1];
            printf "    url: \"%s\",\n", url;
            printf "    category: \"%s\"\n", group[1];
            printf "  }";
        }
        END { 
            print "\n\n]"; 
        }
        ' playlist.m3u > jstar.m3u

    - name: Commit and push updated playlist
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git add jstar.m3u
        git commit -m "Auto-update and format Jio IPTV playlist" || echo "No changes to commit"
        git push

